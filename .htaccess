Options -Indexes
ServerSignature Off

RewriteEngine On

# ----------------------------------------------------------------------------
# 1) Health endpoint (avant tout)
# ----------------------------------------------------------------------------
RewriteRule ^health/?$ health.php [L]

# ----------------------------------------------------------------------------
# 2) Bloquer l'accès web aux dossiers sensibles (adapte selon ton arbo)
# ----------------------------------------------------------------------------
RewriteRule ^(Settings|Src|vendor|Tests|Logs)(/|$) - [F,L]

# Bloquer quelques fichiers sensibles
RewriteRule ^(\.env|composer\.json|composer\.lock|phpunit\.xml)(/|$) - [F,L]

# Bloquer les dotfiles (.git, etc.)
RewriteRule (^|/)\. - [F,L]

# Empêcher l'indexation (en + de robots.txt)
<IfModule mod_headers.c>
  Header set X-Robots-Tag "noindex, nofollow, nosnippet, noarchive"
</IfModule>

# ----------------------------------------------------------------------------
# 3) Laisser passer les fichiers/dossiers réels (assets, images, etc.)
# ----------------------------------------------------------------------------
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# ----------------------------------------------------------------------------
# 4) Clean routing (strict allow-list)
# ----------------------------------------------------------------------------
# /page/<name>  -> index.php?page=<name>
RewriteRule ^page/([A-Za-z0-9_-]+)/?$ index.php?page=$1 [L,QSA]

# /admin/<name> -> index.php?admin_page=<name>
RewriteRule ^admin/([A-Za-z0-9_-]+)/?$ index.php?admin_page=$1 [L,QSA]

# ----------------------------------------------------------------------------
# 5) Aliases explicites (facultatif)
# ----------------------------------------------------------------------------
RewriteRule ^accueil/?$ index.php?page=home [L,QSA]
RewriteRule ^contact/?$ index.php?page=contact [L,QSA]
RewriteRule ^user/?$ index.php?admin_page=users [L,QSA]

# ----------------------------------------------------------------------------
# 6) Catch-all -> router
# ----------------------------------------------------------------------------

RewriteRule ^(.+)$ index.php?route=$1 [L,QSA]
